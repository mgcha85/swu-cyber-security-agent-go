version: '3.8'

services:
  agent:
    build: .
    container_name: agent-server
    ports:
      - "8080:8080"
    environment:
      - QDRANT_ADDR=qdrant:6334
      # Assuming Ollama runs on host. 'host.containers.internal' works for Podman.
      # If using Docker Desktop/Compose, it might be 'host.docker.internal'.
      - OLLAMA_BASE=http://host.containers.internal:11434
    volumes:
      # Volume Mapping: Host's ./doc folder -> Container's /app/doc folder
      - ./doc:/app/doc:ro
    depends_on:
      - qdrant
    # For Linux Podman to resolve host.containers.internal reliably
    extra_hosts:
      - "host.containers.internal:host-gateway"

  qdrant:
    image: qdrant/qdrant:latest
    container_name: qdrant
    ports:
      - "6333:6333"
      - "6334:6334"
    volumes:
      - ./qdrant_data:/qdrant/storage
    restart: always

# Ollama is removed from services as User specified it is running on Host.
