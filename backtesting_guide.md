# Cyber Threat Forecasting & Backtesting Implementation Guide

이 문서는 2023년까지의 데이터를 '과거 지식'으로 사용하여 미래(2024-2026)를 예측하고, 실제 결과와 대조하는 백테스팅 시스템 구축 방안을 종합적으로 제안합니다.

## 1. 데이터 처리 레이어 (Data Processing)
데이터셋별 처리 방식은 다음과 같습니다.

| 데이터셋 | 기준 필드 | 처리 방식 |
| :--- | :--- | :--- |
| **MITRE ATT&CK** | `created`, `modified` | 2023년 12월 31일 이전 생성/수정된 기법만 지식 베이스로 사용 |
| **CISA KEV** | `dateAdded` | 2024년 이후 추가된 취약점은 에이전트에게 숨기고 검증용으로만 사용 |
| **EPSS** | `CVE Year` | `CVE-2023-xxxx` 이하 연도의 스코어만 2023년 시점 지식으로 사용 |

-   **Knowledge Base (Past)**: `data/datasets/2023_slice/enterprise-attack-2023.json`, `cisa_kev-2023.json`, `epss_scores-2023.csv`
    -   에이전트가 "학습된 지식"으로 사용하는 데이터입니다.
-   **Ground Truth (Actual)**: `cisa_kev-actual-2024-2026.json`
    -   에이전트에게는 보이지 않으며, 예측 결과의 정답지로만 활용됩니다.

## 2. RAG 레이어 (Knowledge Injection)
Qdrant에 시계열 컬렉션을 구축하여 지식의 오염을 방지합니다.

-   **컬렉션 구성**:
    -   `cyber_intel_2023`: 2023년 데이터만 인덱싱. 에이전트 전용.
    -   `cyber_intel_full`: 현재(2026년)까지의 모든 데이터. 시스템 관리자/검증용.
-   **검색 필터**: 에이전트가 지식을 검색할 때, `time_locked: true` 플래그를 사용하여 2024년 이후의 정보가 검색 결과에 포함되지 않도록 강제합니다.

## 3. 에이전트 레이어 (Simulation Persona)
에이전트가 특정 시점에 고립된 것처럼 행동하게 프롬프트를 설계합니다.

-   **Persona Injection**:
    ```yaml
    instruction: |
      당신은 2023년 12월 31일에 활동 중인 위협 분석가입니다. 
      당신의 세계에서는 2024년 이후의 사건은 아직 일어나지 않은 미래입니다.
      오직 제공된 2023년 지식 베이스만을 바탕으로 향후 3년(2024-2026)을 예측하십시오.
    ```
-   **Role Playing**: 에이전트가 답변 중 "2024년에 발생한..."과 같은 언급을 하면 페널티를 주거나 필터링하도록 설계합니다.

## 4. 검증 레이어 (Backtesting Evaluation)
예측 보고서가 생성된 후 자동으로 정답과 대조합니다.

-   **Evaluation Pipeline**:
    1.  에이전트가 "CVE-2024-XXXX가 위험할 것 같다"고 예측.
    2.  시스템이 `cisa_kev-actual-2024-2026.json`에서 해당 CVE를 검색.
    3.  **결과 도출**: 
        -   **Hit**: 실제로 악용 사례가 발생함.
        -   **Miss**: 예측했지만 발생하지 않음.
        -   **Surprise**: 예측하지 못했지만 큰 사고가 터짐.

## 5. 종합 워크플로우 예시
1.  **사용자**: "2023년 데이터를 기반으로 향후 3년 위협을 예측해줘."
2.  **Super Agent**: 2023년 버전의 도구들을 호출하여 분석 수행.
3.  **Output**: "2023년 트렌드 기반 2024-2026 예측 보고서" 생성.
4.  **Auto-Validator**: 실제 2024-2026 데이터와 대조하여 "예측 정확도: 75%" 등의 지표와 함께 최종 보고서 완성.

---

## 실행 제안
이 파이프라인을 가동하기 위해 다음 중 어떤 것을 먼저 진행할까요?
1.  **2023년 전용 Qdrant 컬렉션 인덱싱**: 데이터를 실제로 DB에 넣는 과정.
2.  **Forecaster 에이전트 설정 추가**: `config.yaml`에 예측 전용 에이전트 페르소나를 정의하는 과정.
3.  **검증 로직 구현**: 예측값과 실제 정답지를 비교하는 Go 모듈 작성.
